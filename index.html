<!DOCTYPE html>
<html lang="eng">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <title>IWUM - INTERAKTYWNA WIZUALIZACJA URZĄDZEŃ MEDYCZNYCH</title>
        <style>
            body {
                background-color: rgb(132, 177, 180);
            }
            main{
                background-color: rgb(241, 233, 223);
                margin: auto;
                width: 75%;  
            }
            .searchbar{
                display: block;
                margin: auto;
                width: 25%;
            }
            .gallery{
                display: grid;
                grid-template-columns: auto auto auto;
                padding: 10px;
                margin: 10%;
            }
            .gallery-item {
                padding-bottom: 10%;
                padding-top: 10%;
            }
            .desc {
                margin-bottom: 10%;
            }
            .gallery-item img{
                height: 90%;
                width: 90%;
                border-radius: 10%;
                overflow: hidden;
                object-fit: cover;
                align-items: center;
            }
            .clearfix:after {
                content: "";
                display: table;
                clear: both;
            }
            .logo {
                width: 25%;
                margin: auto;
            }
        </style>
    </head>
    <body>
        <div class="naglowek">
            <img class="logo" src="logo.png">
        </div>
        <main>
            <div class="search">
                <select id="categorySelect" class="searchbar">
                    <option value="szpitale">Szpitale</option>
                    <option value="urzadzenia">Urządzenia</option>
                </select>
                <input id="searchInput" class="searchbar" type="text" placeholder="Wyszukaj placówkę lub sprzęt">
            </div>
            <div id="gallery" class="gallery"></div>
            <div class="clearfix"></div>
        </main>
        <script>
        async function fetchResults() {
            const type = document.getElementById('categorySelect').value;
            const q = document.getElementById('searchInput').value;
            const res = await fetch(`/search?type=${type}&q=${encodeURIComponent(q)}`);
            const data = await res.json();
            renderGallery(data, type);
        }
        function renderGallery(items, type) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            if (items.length === 0) {
                gallery.innerHTML = '<div>Brak wyników.</div>';
                return;
            }
            items.forEach(item => {
                let imgSrc = '';
                let linkHref = '';
                if (type === 'szpitale') {
                    // Use id for file mapping
                    linkHref = `szpitale/${item.id}.html`;
                    imgSrc = `szpitale/${item.id}.jpg`;
                } else {
                    linkHref = `urzadzenia/${item.id}.html`;
                    imgSrc = `urzadzenia/${item.id}.jpg`;
                }
                gallery.innerHTML += `
                <div class="gallery-item">
                    <a href="${linkHref}">
                        <img src="${imgSrc}" alt="${item.nazwa}">
                        <div class="desc">${item.nazwa}<br>${item.opis || ''}</div>
                    </a>
                </div>`;
            });
        }
        document.getElementById('categorySelect').addEventListener('change', fetchResults);
        document.getElementById('searchInput').addEventListener('input', fetchResults);
        // Initial load
        fetchResults();
        </script>
    </body>
</html>
